<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
<!-- Navbar -->
<nav class="main-header navbar navbar-expand navbar-white navbar-light"
     style="display: flex; justify-content: space-between" th:fragment="header">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="/home" class="nav-link" th:text="#{header.title}"></a>
        </li>
    </ul>

    <ul class="navbar-nav" style="margin: 0 10px">
        <li class="item">
            <a id="locale_en" href="/home?lang=en" style="margin-right: 10px">English</a>
        </li>
        <li class="item">
            <a id="locale_vi" href="/home?lang=vi">Tiếng việt</a>
        </li>
    </ul>

    <script>

        function replaceUrlParam(url, paramName, paramValue) {
            if (paramValue == null) {
                paramValue = '';
            }
            var pattern = new RegExp('\\b(' + paramName + '=).*?(&|#|$)');
            if (url.search(pattern) >= 0) {
                return url.replace(pattern, '$1' + paramValue + '$2');
            }
            url = url.replace(/[?#]$/, '');
            return url + (url.indexOf('?') > 0 ? '&' : '?') + paramName + '=' + paramValue;
        }

        function getVal(str) {
            var v = window.location.search.match(new RegExp('(?:[\?\&]' + str + '=)([^&]+)'));
            return v ? v[1] : 1;
        }

        function isHaveParams() {
            const href = window.location.href;
            if (href.includes("?"))
                return true;
            return false;
        }

        document.getElementById("locale_en").addEventListener("click", function (ev) {
            ev.preventDefault();
            let paramLang = getVal("lang");
            if (isHaveParams() === true) {
                if (paramLang === 1) { // ko co la them
                    window.location.href = window.location.href + "&lang=en";
                } else { // co la change
                    window.location.href = replaceUrlParam(window.location.href, "lang", "en");
                }
            } else {
                window.location.href = window.location.href + "?lang=en";
            }
        })

        document.getElementById("locale_vi").addEventListener("click", function (ev) {
            ev.preventDefault();
            let paramLang = getVal("lang");
            if (isHaveParams() === true) {
                if (paramLang === 1) { // ko co la them
                    window.location.href = window.location.href + "&lang=vi";
                } else { // co la change
                    window.location.href = replaceUrlParam(window.location.href, "lang", "vi");
                }
            } else {
                window.location.href = window.location.href + "?lang=vi";
            }
        })
    </script>

</nav>
<!-- /.navbar -->


</body>
</html>